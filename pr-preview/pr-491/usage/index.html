<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=../changelog/ rel=prev><link href=../reference/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.1"><title>Usage - Alluka docs</title><link rel=stylesheet href=../assets/stylesheets/main.a40c8224.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.75 1.75 0 0 1 1 7.775m1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25m13.274 9.537zl-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074M4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5M4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13M6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75M8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.5 4.5 0 0 1-.563-1.191 3.84 3.84 0 0 1-.05-2.063 4.65 4.65 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .75.75 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.4 2.4 0 0 1-.507-.441 3.1 3.1 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19.01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.7 3.7 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.75.75 0 0 1 .018-1.042.75.75 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13M6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.76 2.76 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6 6 0 0 0-.26.16 1 1 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661q.154-.1.313-.195l.007-.004c.1-.061.182-.11.258-.161a1 1 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.61.61 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1 1 0 0 0-.34.398M9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0M9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343za8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746m1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275M6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.75.75 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.75.75 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734L6.94 8 4.97 6.03a.75.75 0 0 1 .018-1.042.75.75 0 0 1 1.042-.018"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.25 1.25 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006-.004-.009-.006-.006-.008-.001q-.005 0-.009.004"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.5 3.5 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327q0 .15-.025.292c.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5q-.002.615-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A5 5 0 0 1 8 16a5 5 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5 5 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.7 1.7 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06m.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.17.17 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.75.75 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5m4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5m0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5M2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../assets/_mkdocstrings.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=pink data-md-color-accent=pink> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#usage class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Alluka docs" class="md-header__button md-logo" aria-label="Alluka docs" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Alluka docs </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Usage </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=pink data-md-color-accent=pink aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=pink data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/FasterSpeeding/Alluka title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Alluka docs" class="md-nav__button md-logo" aria-label="Alluka docs" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Alluka docs </label> <div class=md-nav__source> <a href=https://github.com/FasterSpeeding/Alluka title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Alluka </span> </a> </li> <li class=md-nav__item> <a href=../changelog/ class=md-nav__link> <span class=md-ellipsis> Changelog </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Usage </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Usage </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#function-injection class=md-nav__link> <span class=md-ellipsis> Function injection </span> </a> <nav class=md-nav aria-label="Function injection"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#declaring-a-functions-injected-dependencies class=md-nav__link> <span class=md-ellipsis> Declaring a function's injected dependencies </span> </a> <nav class=md-nav aria-label="Declaring a function's injected dependencies"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#default-descriptors class=md-nav__link> <span class=md-ellipsis> Default descriptors </span> </a> </li> <li class=md-nav__item> <a href=#type-hint-metadata class=md-nav__link> <span class=md-ellipsis> Type-hint metadata </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#calling-functions-with-dependency-injection class=md-nav__link> <span class=md-ellipsis> Calling functions with dependency injection </span> </a> </li> <li class=md-nav__item> <a href=#automatic-dependency-injection class=md-nav__link> <span class=md-ellipsis> Automatic dependency injection </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#using-the-client class=md-nav__link> <span class=md-ellipsis> Using the client </span> </a> <nav class=md-nav aria-label="Using the client"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#adding-type-dependencies class=md-nav__link> <span class=md-ellipsis> Adding type dependencies </span> </a> </li> <li class=md-nav__item> <a href=#overriding-callback-dependencies class=md-nav__link> <span class=md-ellipsis> Overriding callback dependencies </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#local-client class=md-nav__link> <span class=md-ellipsis> Local client </span> </a> </li> <li class=md-nav__item> <a href=#custom-injection-contexts class=md-nav__link> <span class=md-ellipsis> Custom injection contexts </span> </a> <nav class=md-nav aria-label="Custom injection contexts"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#caching-injected-callback-results class=md-nav__link> <span class=md-ellipsis> Caching injected callback results </span> </a> </li> <li class=md-nav__item> <a href=#context-specific-type-dependencies class=md-nav__link> <span class=md-ellipsis> Context-specific type dependencies </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../reference/ class=md-nav__link> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#function-injection class=md-nav__link> <span class=md-ellipsis> Function injection </span> </a> <nav class=md-nav aria-label="Function injection"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#declaring-a-functions-injected-dependencies class=md-nav__link> <span class=md-ellipsis> Declaring a function's injected dependencies </span> </a> <nav class=md-nav aria-label="Declaring a function's injected dependencies"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#default-descriptors class=md-nav__link> <span class=md-ellipsis> Default descriptors </span> </a> </li> <li class=md-nav__item> <a href=#type-hint-metadata class=md-nav__link> <span class=md-ellipsis> Type-hint metadata </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#calling-functions-with-dependency-injection class=md-nav__link> <span class=md-ellipsis> Calling functions with dependency injection </span> </a> </li> <li class=md-nav__item> <a href=#automatic-dependency-injection class=md-nav__link> <span class=md-ellipsis> Automatic dependency injection </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#using-the-client class=md-nav__link> <span class=md-ellipsis> Using the client </span> </a> <nav class=md-nav aria-label="Using the client"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#adding-type-dependencies class=md-nav__link> <span class=md-ellipsis> Adding type dependencies </span> </a> </li> <li class=md-nav__item> <a href=#overriding-callback-dependencies class=md-nav__link> <span class=md-ellipsis> Overriding callback dependencies </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#local-client class=md-nav__link> <span class=md-ellipsis> Local client </span> </a> </li> <li class=md-nav__item> <a href=#custom-injection-contexts class=md-nav__link> <span class=md-ellipsis> Custom injection contexts </span> </a> <nav class=md-nav aria-label="Custom injection contexts"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#caching-injected-callback-results class=md-nav__link> <span class=md-ellipsis> Caching injected callback results </span> </a> </li> <li class=md-nav__item> <a href=#context-specific-type-dependencies class=md-nav__link> <span class=md-ellipsis> Context-specific type dependencies </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=usage>Usage<a class=headerlink href=#usage title="Permanent link">#</a></h1> <h2 id=function-injection>Function injection<a class=headerlink href=#function-injection title="Permanent link">#</a></h2> <p>This form of dependency injection works by injecting values for keyword arguments during callback execution based on the linked client. This is the current form of dependency injection implemented by Alluka.</p> <h3 id=declaring-a-functions-injected-dependencies>Declaring a function's injected dependencies<a class=headerlink href=#declaring-a-functions-injected-dependencies title="Permanent link">#</a></h3> <p>There are two styles for declaring a function's injected dependencies in Alluka:</p> <h4 id=default-descriptors>Default descriptors<a class=headerlink href=#default-descriptors title="Permanent link">#</a></h4> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>callback</span><span class=p>(</span>
    <span class=n>foo</span><span class=p>:</span> <span class=n>Foo</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>inject</span><span class=p>(</span><span class=nb>type</span><span class=o>=</span><span class=n>Foo</span><span class=p>),</span>
    <span class=n>bar</span><span class=p>:</span> <span class=n>BarResult</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>inject</span><span class=p>(</span><span class=n>callback</span><span class=o>=</span><span class=n>bar_callback</span><span class=p>),</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=o>...</span>
</code></pre></div> <p>Assigning the result of <a class="autorefs autorefs-internal" href="../reference/#alluka.inject">alluka.inject</a> to a parameter's default will declare it as requiring an injected type or callback.</p> <div class=highlight><pre><span></span><code><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>callback</span><span class=p>(</span><span class=n>foo</span><span class=p>:</span> <span class=n>Foo</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>inject</span><span class=p>())</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>
</code></pre></div> <p>If neither <code>type</code> nor <code>callback</code> is passed to <a class="autorefs autorefs-internal" href="../reference/#alluka.inject">alluka.inject</a> then a type dependency will be inferred from the parameter's annotation.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>The type-hint will need to resolvable/accessible at runtime in the callback's module for it to be inferred (so it can't be hidden behind a <a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/typing.html#typing.TYPE_CHECKING">typing.TYPE_CHECKING</a> only import or using a type or operation that isn't implemented in the current python version).</p> </div> <h4 id=type-hint-metadata>Type-hint metadata<a class=headerlink href=#type-hint-metadata title="Permanent link">#</a></h4> <p><a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/typing.html#typing.Annotated">typing.Annotated</a> style type-hint descriptors may be used to declare the injected dependencies for a function.</p> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>callback</span><span class=p>(</span>
    <span class=n>foo</span><span class=p>:</span> <span class=n>typing</span><span class=o>.</span><span class=n>Annotated</span><span class=p>[</span><span class=n>Foo</span><span class=p>,</span> <span class=n>alluka</span><span class=o>.</span><span class=n>inject</span><span class=p>(</span><span class=nb>type</span><span class=o>=</span><span class=n>Foo</span><span class=p>)],</span>
    <span class=n>bar</span><span class=p>:</span> <span class=n>typing</span><span class=o>.</span><span class=n>Annotated</span><span class=p>[</span><span class=n>BarResult</span><span class=p>,</span> <span class=n>alluka</span><span class=o>.</span><span class=n>inject</span><span class=p>(</span><span class=n>callback</span><span class=o>=</span><span class=n>bar_callback</span><span class=p>)],</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>
</code></pre></div> <p>Where passing the default descriptors returned by <a class="autorefs autorefs-internal" href="../reference/#alluka.inject">alluka.inject</a> to <a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/typing.html#typing.Annotated">typing.Annotated</a> lets you declare the type or callback dependency for an argument without effecting non-DI calls to the function (by leaving these parameters required).</p> <div class=highlight><pre><span></span><code><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>callback</span><span class=p>(</span><span class=n>foo</span><span class=p>:</span> <span class=n>alluka</span><span class=o>.</span><span class=n>Injected</span><span class=p>[</span><span class=n>Foo</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>
</code></pre></div> <p>And <a class="autorefs autorefs-internal" href="../reference/#alluka.Injected">alluka.Injected</a> provides a shorthand for using <a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/typing.html#typing.Annotated">typing.Annotated</a> to declare a type dependency.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p><a class="autorefs autorefs-internal" href="../reference/#alluka.Injected">alluka.Injected</a> can be safely passed to <a class="autorefs autorefs-external" href="https://docs.python.org/3.13/library/typing.html#typing.Annotated">typing.Annotated</a> as the first type argument or vice versa thanks to how Annotated handles nesting.</p> </div> <h3 id=calling-functions-with-dependency-injection>Calling functions with dependency injection<a class=headerlink href=#calling-functions-with-dependency-injection title="Permanent link">#</a></h3> <div class=highlight><pre><span></span><code><span class=n>client</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>Client</span><span class=p>()</span>

<span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>callback</span><span class=p>(</span>
    <span class=n>argument</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
    <span class=o>/</span><span class=p>,</span>
    <span class=n>injected</span><span class=p>:</span> <span class=n>alluka</span><span class=o>.</span><span class=n>Injected</span><span class=p>[</span><span class=n>Foo</span><span class=p>],</span>
    <span class=n>keyword_arg</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
    <span class=o>...</span>

<span class=o>...</span>

<span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>client</span><span class=o>.</span><span class=n>call_with_async_di</span><span class=p>(</span><span class=n>callback</span><span class=p>,</span> <span class=mi>123</span><span class=p>,</span> <span class=n>keyword_arg</span><span class=o>=</span><span class=s2>&quot;ok&quot;</span><span class=p>)</span>
</code></pre></div> <p><a class="autorefs autorefs-internal" href="../reference/abc/#alluka.abc.Client.call_with_async_di">Client.call_with_async_di</a> can be used to execute a function with async dependency injection. Any positional or keyword arguments which are passed with the function will be passed through to the function with the injected values.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>While both sync and async functions may be executed with <code>call_with_async_di</code>, you'll always have to await <code>call_with_async_di</code> to get the result of the call.</p> </div> <div class=highlight><pre><span></span><code><span class=n>client</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>Client</span><span class=p>()</span>

<span class=k>def</span><span class=w> </span><span class=nf>callback</span><span class=p>(</span>
    <span class=n>argument</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
    <span class=o>/</span><span class=p>,</span>
    <span class=n>injected</span><span class=p>:</span> <span class=n>alluka</span><span class=o>.</span><span class=n>Injected</span><span class=p>[</span><span class=n>Foo</span><span class=p>],</span>
    <span class=n>keyword_arg</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
    <span class=o>...</span>

<span class=o>...</span>

<span class=n>result</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>call_with_di</span><span class=p>(</span><span class=n>callback</span><span class=p>,</span> <span class=mi>123</span><span class=p>,</span> <span class=n>keyword_arg</span><span class=o>=</span><span class=s2>&quot;ok&quot;</span><span class=p>)</span>
</code></pre></div> <p><a class="autorefs autorefs-internal" href="../reference/abc/#alluka.abc.Client.call_with_di">Client.call_with_di</a> can be used to execute a function with purely sync dependency injection. This has similar semantics to <code>call_with_async_di</code> for passed through arguments but comes with the limitation that only sync functions may be used and any async callback dependencies will lead to <a class="autorefs autorefs-internal" href="../reference/#alluka.SyncOnlyError">alluka.SyncOnlyError</a> being raised.</p> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>foo</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span> <span class=n>alluka</span><span class=o>.</span><span class=n>Injected</span><span class=p>[</span><span class=n>alluka</span><span class=o>.</span><span class=n>abc</span><span class=o>.</span><span class=n>Context</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=n>result</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=n>call_with_di</span><span class=p>(</span><span class=n>other_callback</span><span class=p>,</span> <span class=mi>542</span><span class=p>,</span> <span class=n>keyword_arg</span><span class=o>=</span><span class=s2>&quot;meow&quot;</span><span class=p>)</span>
</code></pre></div> <p>Alternatively, <a class="autorefs autorefs-internal" href="../reference/abc/#alluka.abc.Context.call_with_di">Context.call_with_di</a> and <a class="autorefs autorefs-internal" href="../reference/abc/#alluka.abc.Context.call_with_async_di">Context.call_with_async_di</a> can be used to execute functions with dependency injection while preserving the current injection context.</p> <div class=highlight><pre><span></span><code><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>bar</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span> <span class=n>alluka</span><span class=o>.</span><span class=n>Injected</span><span class=p>[</span><span class=n>alluka</span><span class=o>.</span><span class=n>abc</span><span class=o>.</span><span class=n>Context</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>ctx</span><span class=o>.</span><span class=n>call_with_async_di</span><span class=p>(</span><span class=n>other_callback</span><span class=p>,</span> <span class=mi>123</span><span class=p>,</span> <span class=n>keyword_arg</span><span class=o>=</span><span class=s2>&quot;ok&quot;</span><span class=p>)</span>
</code></pre></div> <!-- TODO: revisit behaviour for when an async function with no async deps is passed to call_with_di---> <h3 id=automatic-dependency-injection>Automatic dependency injection<a class=headerlink href=#automatic-dependency-injection title="Permanent link">#</a></h3> <div class=highlight><pre><span></span><code><span class=n>client</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>Client</span><span class=p>()</span>

<span class=nd>@client</span><span class=o>.</span><span class=n>auto_inject</span>
<span class=k>def</span><span class=w> </span><span class=nf>callback</span><span class=p>(</span><span class=n>other_arg</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=n>TypeA</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>inject</span><span class=p>())</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>

<span class=n>callback</span><span class=p>(</span><span class=n>other_arg</span><span class=o>=</span><span class=s2>&quot;beep&quot;</span><span class=p>)</span>  <span class=c1># `value` will be injected.</span>
</code></pre></div> <p><a class="autorefs autorefs-internal" href="../reference/abc/#alluka.abc.Client.auto_inject_async">Client.auto_inject</a> and <a class="autorefs autorefs-internal" href="../reference/abc/#alluka.abc.Client.auto_inject_async">Client.auto_inject_async</a> can be used to tie a callback to a specific dependency injection client to enable implicit dependency injection without the need to call <code>call_with_(async_)_di</code> every time the callback is called.</p> <div class=highlight><pre><span></span><code><span class=n>client</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>Client</span><span class=p>()</span>

<span class=nd>@client</span><span class=o>.</span><span class=n>auto_inject_async</span>
<span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>callback</span><span class=p>(</span><span class=n>value</span><span class=p>:</span> <span class=n>TypeA</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>inject</span><span class=p>())</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>

<span class=k>await</span> <span class=n>callback</span><span class=p>()</span>  <span class=c1># `value` will be injected.</span>
</code></pre></div> <p><a class="autorefs autorefs-internal" href="../reference/abc/#alluka.abc.Client.auto_inject">Client.auto_inject</a> comes with similar limitations to <a class="autorefs autorefs-internal" href="../reference/abc/#alluka.abc.Client.call_with_di">Client.call_with_di</a> in that the auto-injecting callback it creates will fail if any of the callback dependencies are asynchronous.</p> <h2 id=using-the-client>Using the client<a class=headerlink href=#using-the-client title="Permanent link">#</a></h2> <!-- TODO: add note about call chaining --> <h3 id=adding-type-dependencies>Adding type dependencies<a class=headerlink href=#adding-type-dependencies title="Permanent link">#</a></h3> <div class=highlight><pre><span></span><code><span class=n>client</span> <span class=o>=</span> <span class=p>(</span>
    <span class=n>alluka</span><span class=o>.</span><span class=n>Client</span><span class=p>()</span>
    <span class=o>.</span><span class=n>set_type_dependency</span><span class=p>(</span><span class=n>TypeA</span><span class=p>,</span> <span class=n>type_a_impl</span><span class=p>)</span>
    <span class=o>.</span><span class=n>set_type_dependency</span><span class=p>(</span><span class=n>TypeB</span><span class=p>,</span> <span class=n>type_b_impl</span><span class=p>)</span>
<span class=p>)</span>
</code></pre></div> <p>For a type dependency to work, the linked client has to have an implementation loaded for each type. <a class="autorefs autorefs-internal" href="../reference/abc/#alluka.abc.Client.set_type_dependency">Client.set_type_dependency</a> is used to pair up the types you'll be using in <a class="autorefs autorefs-internal" href="../reference/#alluka.inject">alluka.inject</a> with initialised implementations of them.</p> <h3 id=overriding-callback-dependencies>Overriding callback dependencies<a class=headerlink href=#overriding-callback-dependencies title="Permanent link">#</a></h3> <div class=highlight><pre><span></span><code><span class=n>client</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>Client</span><span class=p>()</span><span class=o>.</span><span class=n>set_callback_override</span><span class=p>(</span><span class=n>default_callback</span><span class=p>,</span> <span class=n>other_callback</span><span class=p>)</span>
</code></pre></div> <p>While callback dependencies can work on their own without being explicitly declared on the client (unless they're relying on a type dependency themselves), they can still be overridden on a client level using <a class="autorefs autorefs-internal" href="../reference/abc/#alluka.abc.Client.set_callback_override">Client.set_callback_override</a>.</p> <p>Injected callbacks should only be overridden with a callback which returns a compatible type but their signatures do not need to match and async callbacks can be overridden with sync with vice versa also working (although overriding a sync callback with an async callback will prevent the callback from being used in a sync context).</p> <h2 id=local-client>Local client<a class=headerlink href=#local-client title="Permanent link">#</a></h2> <p>Alluka provides a system in <a class="autorefs autorefs-internal" href="../reference/local/#alluka.local">alluka.local</a> which lets you associate an Alluka client or context with the local scope. This can make dependency injection easier for application code as it avoids the need to lug around an injection client or context.</p> <p>The local "scope" will either be the current thread, an async event loop (e.g. asyncio event loop), an async task, or an async future.</p> <p>While child async tasks and futures will inherit the local client/context, child threads will not.</p> <div class=highlight><pre><span></span><code><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>callback</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>alluka</span><span class=o>.</span><span class=n>local</span><span class=o>.</span><span class=n>call_with_async_di</span><span class=p>(</span><span class=n>async_callback</span><span class=p>)</span>

<span class=k>with</span> <span class=n>alluka</span><span class=o>.</span><span class=n>local</span><span class=o>.</span><span class=n>scope_client</span><span class=p>()</span> <span class=k>as</span> <span class=n>client</span><span class=p>:</span>
    <span class=n>client</span><span class=o>.</span><span class=n>set_type_dependency</span><span class=p>(</span><span class=n>TypeA</span><span class=p>,</span> <span class=n>type_a_impl</span><span class=p>)</span>

    <span class=k>await</span> <span class=n>callback</span><span class=p>()</span>
</code></pre></div> <p>Either <a class="autorefs autorefs-internal" href="../reference/local/#alluka.local.initialize">alluka.local.initialize</a> or <a class="autorefs autorefs-internal" href="../reference/local/#alluka.local.scope_client">alluka.local.scope_client</a> needs to be called to declare a client within the current scope before the other functionality in <a class="autorefs autorefs-internal" href="../reference/local/#alluka.local">alluka.local</a> can be used. These can be passed a client to declare but defaults to creating a new client.</p> <p>The client is then configured like normal and <a class="autorefs autorefs-internal" href="../reference/local/#alluka.local.get_client">alluka.local.get_client</a> can be used to get the set client for the current scope.</p> <div class=highlight><pre><span></span><code><span class=n>client</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>Client</span><span class=p>()</span>

<span class=n>context</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>OverridingContext</span><span class=o>.</span><span class=n>from_client</span><span class=p>(</span><span class=n>client</span><span class=p>)</span><span class=o>.</span><span class=n>set_type_dependency</span><span class=p>(</span><span class=n>TypeA</span><span class=p>,</span> <span class=n>TypeA</span><span class=p>())</span>

<span class=k>with</span> <span class=n>alluka</span><span class=o>.</span><span class=n>local</span><span class=o>.</span><span class=n>scope_context</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
    <span class=n>alluka</span><span class=o>.</span><span class=n>local</span><span class=o>.</span><span class=n>call_with_di</span><span class=p>(</span><span class=n>bar_callback</span><span class=p>)</span>
</code></pre></div> <p><a class="autorefs autorefs-internal" href="../reference/local/#alluka.local.scope_context">scope_context</a> can be used to set the Injection context for a scope and will also set the context's client as the local client. This will be prioritised over <a class="autorefs autorefs-internal" href="../reference/local/#alluka.local.scope_client">alluka.local.scope_client</a> and <code>initialize</code> when making calls to the local call with DI functions. <a class="autorefs autorefs-internal" href="../reference/local/#alluka.local.get_context">alluka.local.get_context</a> returns the set context.</p> <p><a class="autorefs autorefs-internal" href="../reference/local/#alluka.local.scope_client">scope_client</a>/<a class="autorefs autorefs-internal" href="../reference/local/#alluka.local.scope_context">scope_context</a> are recommended over <code>initialize</code> as these avoid declaring the client/context globally.</p> <div class=highlight><pre><span></span><code><span class=n>client</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>local</span><span class=o>.</span><span class=n>initialize</span><span class=p>()</span>
<span class=n>client</span><span class=o>.</span><span class=n>set_type_dependency</span><span class=p>(</span><span class=n>TypeA</span><span class=p>,</span> <span class=n>type_a_impl</span><span class=p>)</span>

<span class=o>...</span>

<span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>callback</span><span class=p>(</span><span class=n>value</span><span class=p>:</span> <span class=n>TypeA</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>inject</span><span class=p>())</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>

<span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>alluka</span><span class=o>.</span><span class=n>local</span><span class=o>.</span><span class=n>call_with_async_di</span><span class=p>(</span><span class=n>callback</span><span class=p>)</span>
</code></pre></div> <p><a class="autorefs autorefs-internal" href="../reference/local/#alluka.local.call_with_async_di">alluka.local.call_with_async_di</a>, <a class="autorefs autorefs-internal" href="../reference/local/#alluka.local.call_with_di">alluka.local.call_with_di</a> can be used to call a function with the dependency injection client that's set for the current scope.</p> <div class=highlight><pre><span></span><code><span class=nd>@alluka</span><span class=o>.</span><span class=n>local</span><span class=o>.</span><span class=n>auto_inject_async</span>
<span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>callback</span><span class=p>(</span><span class=n>value</span><span class=p>:</span> <span class=n>TypeA</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>inject</span><span class=p>())</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>

<span class=k>with</span> <span class=n>alluka</span><span class=o>.</span><span class=n>local</span><span class=o>.</span><span class=n>scope_client</span><span class=p>()</span> <span class=k>as</span> <span class=n>client</span><span class=p>:</span>
    <span class=n>client</span><span class=o>.</span><span class=n>set_type_dependency</span><span class=p>(</span><span class=n>TypeA</span><span class=p>,</span> <span class=n>type_a_impl</span><span class=p>)</span>

    <span class=k>await</span> <span class=n>callback</span><span class=p>()</span>
</code></pre></div> <p><a class="autorefs autorefs-internal" href="../reference/local/#alluka.local.auto_inject">alluka.local.auto_inject</a>, and <a class="autorefs autorefs-internal" href="../reference/local/#alluka.local.auto_inject_async">alluka.local.auto_inject_async</a> act a little different to the similar client methods: instead of binding a callback to a specific client to enable automatic dependency injection, these will get the local client/context for dependency injection when the auto-injecting callback is called.</p> <p>As such <code>auto_inject</code> and <code>auto_inject_async</code> can be used to make an auto-injecting callback before a local client/context has been set but any calls to the returned auto-injecting callbacks will only work within a scope where <code>initialise</code> or <code>scope_client</code> or <code>scope_context</code> is in effect.</p> <h2 id=custom-injection-contexts>Custom injection contexts<a class=headerlink href=#custom-injection-contexts title="Permanent link">#</a></h2> <p>Under the hood Alluka builds a <a class="autorefs autorefs-internal" href="../reference/abc/#alluka.abc.Context">alluka.abc.Context</a> for each call to a <code>call_with_{async}_di</code> method.</p> <div class=highlight><pre><span></span><code><span class=n>client</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>Client</span><span class=p>()</span><span class=o>.</span><span class=n>set_make_context</span><span class=p>(</span><span class=n>alluka</span><span class=o>.</span><span class=n>CachingContext</span><span class=p>)</span>
</code></pre></div> <p><a class="autorefs autorefs-internal" href="../reference/#alluka.Client.set_make_context">alluka.Client.set_make_context</a> can be used to change how the client creates DI contexts to customise how dependency injection behaves.</p> <h3 id=caching-injected-callback-results>Caching injected callback results<a class=headerlink href=#caching-injected-callback-results title="Permanent link">#</a></h3> <p>By default, injected callbacks are called every time they're found within the context of a dependency injection call.</p> <p><a class="autorefs autorefs-internal" href="../reference/#alluka.CachingContext">alluka.CachingContext</a> can be set as the component maker to enable the caching of the result of callback dependencies.</p> <div class=highlight><pre><span></span><code><span class=n>client</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>Client</span><span class=p>()</span><span class=o>.</span><span class=n>set_make_context</span><span class=p>(</span><span class=n>alluka</span><span class=o>.</span><span class=n>CachingContext</span><span class=p>)</span>
<span class=n>state</span> <span class=o>=</span> <span class=mi>0</span>

<span class=k>def</span><span class=w> </span><span class=nf>injected_callback</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
    <span class=k>nonlocal</span> <span class=n>state</span>
    <span class=n>state</span> <span class=o>+=</span> <span class=mi>1</span>

    <span class=k>return</span> <span class=n>state</span>

<span class=k>def</span><span class=w> </span><span class=nf>callback</span><span class=p>(</span>
    <span class=n>result</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>inject</span><span class=p>(</span><span class=n>callback</span><span class=o>=</span><span class=n>injected_callback</span><span class=p>),</span>
    <span class=n>other_result</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>inject</span><span class=p>(</span><span class=n>callback</span><span class=o>=</span><span class=n>injected_callback</span><span class=p>),</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>other_result</span><span class=p>)</span>

<span class=n>client</span><span class=o>.</span><span class=n>call_with_di</span><span class=p>(</span><span class=n>callback</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=s2>&quot;-&quot;</span><span class=p>)</span>
<span class=n>client</span><span class=o>.</span><span class=n>call_with_di</span><span class=p>(</span><span class=n>callback</span><span class=p>)</span>
</code></pre></div> <p>This example will result in the following output where <code>state</code> is only injected once per top-level call with <code>call_with_di</code>.</p> <div class=highlight><pre><span></span><code><span class=o>&gt;&gt;&gt;</span> <span class=mi>1</span>
<span class=o>&gt;&gt;&gt;</span> <span class=o>-</span>
<span class=o>&gt;&gt;&gt;</span> <span class=mi>1</span>
</code></pre></div> <p>This caches the results in a DI context so if the same DI context is used to call multiple callbacks with dependency injection then these cached values will be persisted between those calls.</p> <h3 id=context-specific-type-dependencies>Context-specific type dependencies<a class=headerlink href=#context-specific-type-dependencies title="Permanent link">#</a></h3> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>callback</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span> <span class=n>alluka</span><span class=o>.</span><span class=n>Injected</span><span class=p>[</span><span class=n>alluka</span><span class=o>.</span><span class=n>abc</span><span class=o>.</span><span class=n>Context</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=n>ctx</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>OverridingContext</span><span class=p>(</span><span class=n>ctx</span><span class=p>)</span><span class=o>.</span><span class=n>set_type_dependency</span><span class=p>(</span><span class=n>TypeA</span><span class=p>,</span> <span class=n>type_a_impl</span><span class=p>)</span>

    <span class=n>ctx</span><span class=o>.</span><span class=n>call_with_di</span><span class=p>(</span><span class=n>other_callback</span><span class=p>)</span>
</code></pre></div> <p><a class="autorefs autorefs-internal" href="../reference/#alluka.OverridingContext">alluka.OverridingContext</a> to add context specific type dependency overrides to an existing DI context.</p> <div class=highlight><pre><span></span><code><span class=n>client</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>Client</span><span class=p>()</span><span class=o>.</span><span class=n>set_type_dependency</span><span class=p>(</span><span class=n>TypeA</span><span class=p>,</span> <span class=n>type_a_impl</span><span class=p>)</span>

<span class=n>ctx</span> <span class=o>=</span> <span class=n>alluka</span><span class=o>.</span><span class=n>OverridingContext</span><span class=o>.</span><span class=n>from_client</span><span class=p>(</span><span class=n>client</span><span class=p>)</span><span class=o>.</span><span class=n>set_type_dependency</span><span class=p>(</span><span class=n>TypeB</span><span class=p>,</span> <span class=n>type_b_impl</span><span class=p>)</span>

<span class=n>ctx</span><span class=o>.</span><span class=n>call_with_di</span><span class=p>(</span><span class=n>other_callback</span><span class=p>)</span>
</code></pre></div> <p><a class="autorefs autorefs-internal" href="../reference/#alluka.OverridingContext.from_client">alluka.OverridingContext.from_client</a> lets you create a context with type dependency overrides straight from an Alluka client.</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.prune"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.5090c770.min.js></script> </body> </html>